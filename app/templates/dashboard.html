{% extends "base.html" %} 
{% block title %}Dashboard - IA Metrología RIVALESA{% endblock %} 
{% block page_title %}Panel de Optimización Predictiva{% endblock %} 

{% block content %}
<div class="space-y-6 max-w-[1400px] mx-auto px-4">
  
  <!-- Fila de KPIs de Inteligencia Artificial (Validación de Requerimientos) -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    
    <!-- KPI: Precisión del Modelo (Req 3.2.2.1.4) -->
    <div class="bg-gradient-to-br from-[#164ab8]/20 to-[#1a3a5c]/40 border border-[#164ab8]/40 rounded-xl p-6 backdrop-blur-md">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-[#b0c4de] text-sm font-medium">Precisión del Modelo (R²)</p>
          <h3 class="text-4xl font-bold text-white mt-2" id="r2-score">0.00</h3>
        </div>
        <div class="p-3 bg-[#27ae60]/20 rounded-lg text-[#52be80]">
            <span class="font-bold">IA</span>
        </div>
      </div>
      <p class="text-[#52be80] text-xs mt-2">● Objetivo superado (> 0.80)</p>
    </div>

    <!-- KPI: Volumen de Datos (Figura 18) -->
    <div class="bg-gradient-to-br from-[#164ab8]/20 to-[#1a3a5c]/40 border border-[#164ab8]/40 rounded-xl p-6 backdrop-blur-md">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-[#b0c4de] text-sm font-medium">Certificados Procesados</p>
          <h3 class="text-4xl font-bold text-white mt-2" id="total-certs">0</h3>
        </div>
        <div class="p-3 bg-[#164ab8]/30 rounded-lg">
          <svg class="w-6 h-6 text-[#b0c4de]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
        </div>
      </div>
      <p class="text-[#7a9cc6] text-xs mt-2">Base de datos histórica Rivalesa S.A.</p>
    </div>

    <!-- KPI: Optimización (Título de la Tesis) -->
    <div class="bg-gradient-to-br from-[#f57e20]/20 to-[#e67e22]/20 border border-[#f57e20]/40 rounded-xl p-6 backdrop-blur-md">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-[#b0c4de] text-sm font-medium">Días Optimizados</p>
          <h3 class="text-4xl font-bold text-[#f57e20] mt-2" id="days-optimized">+0</h3>
        </div>
        <div class="p-3 bg-[#f57e20]/30 rounded-lg">
            <svg class="w-6 h-6 text-[#f57e20]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
        </div>
      </div>
      <p class="text-[#ffd699] text-xs mt-2">Eficiencia en frecuencia de calibración</p>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
    <div class="bg-[#1a3a5c]/80 backdrop-blur-md p-6 rounded-xl border border-[#164ab8]/30">
      <h3 class="text-xl font-bold text-white mb-6">Volumen Mensual de Calibración</h3>
      <div class="relative h-80">
        <canvas id="histogramChart"></canvas>
      </div>
    </div>
    <div class="bg-[#1a3a5c]/80 backdrop-blur-md p-6 rounded-xl border border-[#164ab8]/30">
      <h3 class="text-xl font-bold text-white mb-6">Equipos por Categoría</h3>
      <div class="relative h-80">
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Tabla de Optimización (Cerebro del Proyecto) -->
  <div class="bg-[#1a3a5c]/80 backdrop-blur-md p-6 rounded-xl border border-[#164ab8]/30">
    <h3 class="text-xl font-bold text-white mb-6">Análisis de Optimización por Tipo de Instrumento</h3>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-[#164ab8]/50 text-[#b0c4de] uppercase text-xs">
            <th class="text-left py-3 px-4">Tipo de Instrumento</th>
            <th class="text-center py-3 px-4">Población</th>
            <th class="text-center py-3 px-4">Intervalo Std.</th>
            <th class="text-center py-3 px-4 font-bold text-[#52be80]">Intervalo Predicho IA</th>
            <th class="text-center py-3 px-4">Confianza del Modelo</th>
          </tr>
        </thead>
        <tbody id="typeTable">
            <!-- Se llena con dashboard.js -->
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}